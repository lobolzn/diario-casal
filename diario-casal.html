<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Diário do Casal</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ff6b6b;--muted:#9aa4b2;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:linear-gradient(180deg,#071022 0%, #071826 60%); color:#e6eef6; min-height:100vh}
    .wrap{max-width:1100px;margin:32px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#ff9a9a);display:flex;align-items:center;justify-content:center;font-weight:700;color:#102027}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted)}
    .controls{display:flex;gap:8px}
    button, input[type=file]{background:var(--card);color:inherit;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}

    .layout{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:22px}
    .panel{background:var(--card);padding:16px;border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    form .row{display:flex;gap:8px;margin-bottom:10px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type=text], textarea, input[type=date]{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    textarea{min-height:100px;resize:vertical}
    .thumb{width:100%;height:220px;border-radius:10px;background:var(--glass);display:flex;align-items:center;justify-content:center;color:var(--muted);overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}

    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;overflow:hidden;cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .card img{width:100%;height:140px;object-fit:cover;display:block}
    .meta{padding:10px}
    .meta h3{margin:0;font-size:15px}
    .meta p{margin:6px 0 0;font-size:13px;color:var(--muted)}

    .empty{padding:40px;text-align:center;color:var(--muted);border-radius:10px}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.75));z-index:60}
    .modal.open{display:flex}
    .viewer{width:90%;max-width:900px;background:#091021;border-radius:12px;overflow:hidden}
    .viewer .figure{height:520px;background:#04101b;display:flex;align-items:center;justify-content:center}
    .viewer img{max-width:100%;max-height:100%;object-fit:contain}
    .viewer .info{padding:14px;display:flex;align-items:center;justify-content:space-between}
    .viewer .info .left{max-width:75%}
    .viewer .info h2{margin:0}
    .viewer .info p{margin:6px 0 0;color:var(--muted)}

    .tiny{font-size:13px;color:var(--muted)}
    .row-between{display:flex;gap:8px;align-items:center}

    footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px}

    @media (max-width:900px){.layout{grid-template-columns:1fr} .viewer .figure{height:360px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">❤</div>
        <div>
          <h1>Diário do Casal</h1>
          <p class="lead">Registre fotos, lembranças e momentos especiais — só vocês dois.</p>
        </div>
      </div>
      <div class="controls">
        <button id="exportBtn">Exportar JSON</button>
        <button id="importBtn" class="ghost">Importar</button>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button id="clearBtn" class="ghost">Limpar tudo</button>
      </div>
    </header>

    <section class="layout">
      <aside class="panel">
        <h3>Adicionar momento</h3>
        <form id="momentForm">
          <div class="row">
            <div style="flex:1">
              <label>Título</label>
              <input id="title" type="text" placeholder="Ex: Nosso primeiro show juntos">
            </div>
          </div>
          <div class="row">
            <div style="flex:1">
              <label>Data</label>
              <input id="date" type="date">
            </div>
          </div>
          <div>
            <label>Descrição</label>
            <textarea id="desc" placeholder="O que aconteceu nesse dia?"></textarea>
          </div>
          <div style="margin-top:10px">
            <label>Foto</label>
            <div class="thumb" id="thumb">Arraste ou clique para carregar
              <input id="photoInput" type="file" accept="image/*" style="position:absolute;inset:0;opacity:0;cursor:pointer">
            </div>
          </div>
          <div style="display:flex;gap:8px;margin-top:12px">
            <button type="submit">Salvar momento</button>
            <button id="cancel" type="button" class="ghost">Limpar</button>
          </div>
        </form>

        <div style="margin-top:16px">
          <h4>Ajuda rápida</h4>
          <p class="tiny">Tudo é salvo localmente no seu navegador. Use "Exportar" para criar backup e "Importar" para restaurar em outro dispositivo.</p>
        </div>
      </aside>

      <main>
        <div class="panel">
          <h3>Galeria de momentos</h3>
          <div id="gallery" class="gallery" style="margin-top:12px"></div>
          <div id="empty" class="empty" style="display:none">Nenhum momento registrado ainda. Adicione o primeiro à esquerda!</div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h3>Linha do tempo</h3>
          <div id="timeline" style="margin-top:10px"></div>
        </div>
      </main>
    </section>

    <footer>Feito com carinho — abra o arquivo HTML no navegador para usar. Seus dados ficam no seu dispositivo.</footer>
  </div>

  <div id="modal" class="modal" aria-hidden="true">
    <div class="viewer" role="dialog" aria-modal="true">
      <div class="figure" id="modalFigure"></div>
      <div class="info">
        <div class="left">
          <h2 id="modalTitle"></h2>
          <p id="modalDate" class="tiny"></p>
          <p id="modalDesc" style="margin-top:8px;color:var(--muted)"></p>
        </div>
        <div class="row-between" style="padding-left:8px">
          <button id="deleteBtn" class="ghost">Excluir</button>
          <button id="closeBtn">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // storage key
    const KEY = 'diario-casal-v1'
    const galleryEl = document.getElementById('gallery')
    const timelineEl = document.getElementById('timeline')
    const emptyEl = document.getElementById('empty')
    const form = document.getElementById('momentForm')
    const titleIn = document.getElementById('title')
    const dateIn = document.getElementById('date')
    const descIn = document.getElementById('desc')
    const photoInput = document.getElementById('photoInput')
    const thumb = document.getElementById('thumb')
    const modal = document.getElementById('modal')
    const modalFigure = document.getElementById('modalFigure')
    const modalTitle = document.getElementById('modalTitle')
    const modalDate = document.getElementById('modalDate')
    const modalDesc = document.getElementById('modalDesc')
    const deleteBtn = document.getElementById('deleteBtn')

    let items = load()
    let currentViewId = null
    let currentImageData = null

    renderAll()

    // load from localStorage
    function load(){
      try{
        const raw = localStorage.getItem(KEY)
        return raw ? JSON.parse(raw) : []
      }catch(e){return []}
    }
    function save(){localStorage.setItem(KEY, JSON.stringify(items))}

    function renderAll(){
      renderGallery()
      renderTimeline()
      emptyEl.style.display = items.length ? 'none' : 'block'
    }

    function renderGallery(){
      galleryEl.innerHTML = ''
      items.slice().reverse().forEach(it => {
        const c = document.createElement('div')
        c.className = 'card'
        c.dataset.id = it.id
        c.innerHTML = `<img src="${it.image}" alt="${escapeHtml(it.title)}"><div class="meta"><h3>${escapeHtml(it.title)}</h3><p>${escapeHtml(it.date||'')}</p></div>`
        c.addEventListener('click', ()=> openModal(it.id))
        galleryEl.appendChild(c)
      })
    }

    function renderTimeline(){
      const sorted = items.slice().sort((a,b)=> new Date(b.date||0)-new Date(a.date||0))
      timelineEl.innerHTML = ''
      sorted.forEach(it => {
        const d = document.createElement('div')
        d.style.padding = '10px 0'; d.style.borderBottom = '1px dashed rgba(255,255,255,0.03)'
        d.innerHTML = `<div style="display:flex;gap:12px;align-items:center"><div style='width:64px;height:64px;border-radius:8px;overflow:hidden'><img src="${it.image}" style='width:64px;height:64px;object-fit:cover'></div><div style='flex:1'><strong>${escapeHtml(it.title)}</strong><div class='tiny'>${escapeHtml(it.date||'')}</div><div style='color:var(--muted);margin-top:6px'>${escapeHtml(it.desc||'')}</div></div><div style='padding-left:8px'><button data-id='${it.id}' class='ghost'>Ver</button></div></div>`
        timelineEl.appendChild(d)
        d.querySelector('button').addEventListener('click', ()=> openModal(it.id))
      })
    }

    // form
    photoInput.addEventListener('change', (e)=>{
      const f = e.target.files[0]
      if(!f) return
      const reader = new FileReader()
      reader.onload = ()=>{
        currentImageData = reader.result
        showThumb(currentImageData)
      }
      reader.readAsDataURL(f)
    })

    thumb.addEventListener('dragover', (e)=>{e.preventDefault(); thumb.style.opacity=0.9})
    thumb.addEventListener('dragleave', ()=>{thumb.style.opacity=1})
    thumb.addEventListener('drop', (e)=>{
      e.preventDefault(); thumb.style.opacity=1
      const f = e.dataTransfer.files[0]
      if(!f) return
      const r = new FileReader()
      r.onload = ()=>{currentImageData = r.result; showThumb(currentImageData)}
      r.readAsDataURL(f)
    })

    function showThumb(src){thumb.innerHTML = ''
      const img = document.createElement('img'); img.src = src
      thumb.appendChild(img)
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault()
      const title = titleIn.value.trim() || 'Momento sem título'
      const date = dateIn.value || new Date().toISOString().slice(0,10)
      const desc = descIn.value.trim()
      const image = currentImageData || placeholderImage(title)
      const id = 'm_' + Date.now()
      items.push({id,title,date,desc,image})
      save()
      clearForm()
      renderAll()
    })

    document.getElementById('cancel').addEventListener('click', clearForm)
    function clearForm(){form.reset(); currentImageData = null; thumb.innerHTML = 'Arraste ou clique para carregar'}

    function openModal(id){
      const it = items.find(x=>x.id===id)
      if(!it) return
      currentViewId = id
      modalFigure.innerHTML = `<img src='${it.image}' alt='${escapeHtml(it.title)}'>`
      modalTitle.textContent = it.title
      modalDate.textContent = it.date || ''
      modalDesc.textContent = it.desc || ''
      modal.classList.add('open')
    }

    document.getElementById('closeBtn').addEventListener('click', ()=> modal.classList.remove('open'))
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('open') })

    deleteBtn.addEventListener('click', ()=>{
      if(!currentViewId) return
      if(!confirm('Excluir esse momento? A ação não pode ser desfeita.')) return
      items = items.filter(x=>x.id!==currentViewId)
      save()
      renderAll()
      modal.classList.remove('open')
    })

    // export / import
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const a = document.createElement('a')
      const blob = new Blob([JSON.stringify(items, null, 2)], {type:'application/json'})
      a.href = URL.createObjectURL(blob)
      a.download = 'diario-casal-backup.json'
      a.click()
      URL.revokeObjectURL(a.href)
    })

    document.getElementById('importBtn').addEventListener('click', ()=> document.getElementById('importFile').click())
    document.getElementById('importFile').addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return
      const r = new FileReader(); r.onload = ()=>{
        try{
          const parsed = JSON.parse(r.result)
          if(!Array.isArray(parsed)) throw new Error('Formato inválido')
          if(!confirm('Substituir os dados atuais pelo arquivo importado?')) return
          items = parsed; save(); renderAll(); alert('Importação concluída')
        }catch(err){alert('Erro ao importar: ' + err.message)}
      }
      r.readAsText(f)
    })

    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(!confirm('Limpar todos os momentos? Essa ação não pode ser desfeita.')) return
      items = []; save(); renderAll();
    })

    // helpers
    function placeholderImage(text){
      const canvas = document.createElement('canvas'); canvas.width=1200; canvas.height=800
      const ctx = canvas.getContext('2d')
      ctx.fillStyle = '#0b1220'; ctx.fillRect(0,0,canvas.width,canvas.height)
      ctx.fillStyle = '#183140'; ctx.fillRect(0,0,canvas.width,canvas.height)
      ctx.fillStyle = '#ffffff22'; ctx.fillRect(0,0,canvas.width,canvas.height)
      ctx.fillStyle = '#ffffff55'; ctx.font='48px sans-serif'; ctx.textAlign='center'
      ctx.fillText(text.slice(0,30), canvas.width/2, canvas.height/2)
      return canvas.toDataURL('image/png')
    }

    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

  </script>
</body>
</html>
